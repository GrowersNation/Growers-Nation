<div data-role="page" class="page-start" id="page-start" style="width:100%; height:100%;">
	<div data-role="header" data-position="fixed" id="header"><a href="index.html" data-icon="gear" class="ui-btn-right">Options</a><h2>Growers Nation</h2></div>
	
	<div data-role="content">
		<form action="" method="post">
			<div data-role="fieldcontain" class="ui-hide-label">
				<label for="location">Location:</label>
				<input type="text" name="location" id="location" data-mini="true" placeholder="Location" />
			</div>
			
			<input type="button" name="locationEntered" id="locationEntered" value="Search Location" />
			<input type="button" name="defaultLocation" id="defaultLocation" value="Search Current Location" />
		</form> 
	</div>
	
	<div data-role="footer" data-position="fixed" id="toolbar"></div>
</div>

<div data-role="page" class="page-map" id="page-map" style="width:100%; height:100%;">
	<div data-role="header" data-position="fixed" id="header">
		<a href="index.html" data-icon="home" class="ui-btn-left home">Home</a><h2>Growers Nation</h2><a href="index.html" data-icon="gear" class="ui-btn-right">Options</a>
	</div>
	
	<div data-role="content" style="padding: 0;">
		<div id="map" style="width:100%; height: 100%;"></div>
	</div>
	
	<div data-role="footer" data-position="fixed" id="toolbar">
		<a href="index.html" data-icon="home" class="ui-btn-left home">Grow</a>
	</div>
</div>

<style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0; overflow: hidden;}
      #map {width: 100%; height: 100%;}
</style>
    
<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=AIzaSyDbm_tgr-6BMbH6BxoG2Sl2U_YAGIESjII&sensor=true">
</script>

<script type="text/javascript">
	var center;
	var map = null;
	var loc = null;
	var geocoder = null;
	
	$(document).ready(function() {
		geocoder = new google.maps.Geocoder();
		
		$(document).bind("pagechange", onPageChange);
	
		$("input[name='locationEntered']").click(function() {
			loc = $("input[name='location']").val();
			changeToMap();
			return false;
		});
		
		$("input[name='defaultLocation']").click(function() {
			changeToMap();
			return false;
		});
		
		$(".home").click(function() {
			changeToHome();
			return false;
		});
	});
	
	function initMap(lat,lng) {
		center = new google.maps.LatLng(lat,lng);
			var myOptions = {
			zoom: 14,
			center: center,
			mapTypeId: google.maps.MapTypeId.ROADMAP
		}
	
		map = new google.maps.Map(document.getElementById("map"), myOptions);
	}
	
	function detectBrowser() {
		var useragent = navigator.userAgent;
		var mapdivMap = document.getElementById("map");
		
		console.log();
		
		if (useragent.indexOf('iPhone') != -1 || useragent.indexOf('Android') != -1 ) {
			mapdivMap.style.width = '100%';
			mapdivMap.style.height = calculateHeight() + 'px';
		} 
		else {
			mapdivMap.style.width = '100%';
			mapdivMap.style.height = calculateHeight() + 'px';
		}
	};
	
	function changeToHome() {
		$.mobile.changePage($("#page-start"));
	}
	
	function changeToMap() {
		$.mobile.changePage($("#page-map"));
	}
	
	function onPageChange(toPage, options) {		
		var page = options.toPage.attr("id");
		
		if(page == "page-map") {
			if(loc != null) {
				detectBrowser();
				geocoder.geocode( { 'address': loc}, function(results, status) {
	      			if (status == google.maps.GeocoderStatus.OK) {
	        			initMap(results[0].geometry.location.lat(),results[0].geometry.location.lng());
	        			var marker = new google.maps.Marker({
	            			map: map,
	            			position: results[0].geometry.location
	        			});
	      			} else {
	        			alert("Geocode was not successful for the following reason: " + status);
	      			}
	    		});
			}
			else if(navigator.geolocation) {
				detectBrowser();
				navigator.geolocation.getCurrentPosition(function(position){
					initMap(position.coords.latitude,position.coords.longitude);
				});
			}
			else{
				detectBrowser();
				initMap(52.636161,-1.133065);
			}
		}
	}
	
	function calculateHeight() {
		return $(window).height() - $("#header").height();
	}
</script>