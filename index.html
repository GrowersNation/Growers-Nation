<body>
	<head>
		<script src="javascripts/jquery.js"></script>
		<link rel="stylesheet" href="style.css" />
		
		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.css" />
		<script src="http://code.jquery.com/jquery-1.6.4.min.js"></script>
		<script src="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.js"></script>
	</head>
	
	<body>
		<div data-role="page" class="page-start" id="page-start" style="width:100%; height:100%;">
			<div data-role="header" data-position="fixed" id="header"><a href="index.html" data-icon="home" class="ui-btn-left home">Home</a><h2>Growers Nation</h2></div>
			
			<div data-role="content">
				<form action="" method="post">
					<div data-role="fieldcontain" class="ui-hide-label">
						<label for="location">Location:</label>
						<input type="text" name="location" id="location" data-mini="true" placeholder="Location" />
					</div>
					
					<input type="button" name="locationEntered" id="locationEntered" value="Search Location" />
					<input type="button" name="defaultLocation" id="defaultLocation" value="Search Default Location" />
				</form> 
			</div>
			
			<div data-role="footer" data-position="fixed" id="toolbar"></div>
		</div>
		
		<div data-role="page" class="page-map" id="page-map" style="width:100%; height:100%;">
			<div data-role="header" id="map-header" style="display: none;"><a href="index.html" data-icon="home" class="ui-btn-left home">Home</a><h2>Growers Nation</h2></div>
			
			<div data-role="content" style="padding: 0; height: 100%" class="mapDiv content">
				<div id="map" style="width:100%; height: 100%;"></div>
			</div>
			
			<div data-role="footer" id="map-footer" class="ui-bar" style="display: none;">
				<a href="index.html" id="map-button" data-role="button" class="mapButtn">Map</a>
				<a href="index.html" id="crop-button" data-role="button" class="cropButton">Crops</a>
			</div>
		</div>
		
		<div data-role="page" class="page-crop" id="page-crop" style="width:100%; height:100%;">
			<div data-role="header" id="map-header"><a href="add.par.html" data-rel="dialog" data-icon="gear" class="ui-btn-right">Options</a><h2>Growers Nation</h2></div>
			
			<div data-role="content" style="padding: 0; height: 100%" class="mapDiv content">
				<div class="monthNav">
					<ul>
						<li><a href="#" data-role="button">Jan</a></li>
						<li><a href="#" data-role="button">Feb</a></li>
						<li><a href="#" data-role="button">Mar</a></li>
						<li><a href="#" data-role="button">Apr</a></li>
						<li><a href="#" data-role="button">May</a></li>
						<li><a href="#" data-role="button">Jun</a></li>
						<li><a href="#" data-role="button">Jul</a></li>
						<li><a href="#" data-role="button">Aug</a></li>
						<li><a href="#" data-role="button">Sep</a></li>
						<li><a href="#" data-role="button">Oct</a></li>
						<li><a href="#" data-role="button">Nov</a></li>
						<li><a href="#" data-role="button">Dec</a></li>
					</ul>
				</div>
				<div id="data">
					<table width="100%">
						<tr>
							<th>
								Fruits
							</th>
							<th>
								Veg
							</th>
							<th>
								Grain
							</th>
						</tr>
					</table>
				</div>
			</div>
			
			<div data-role="footer" id="crop-footer" class="ui-bar">
				<a href="index.html" id="map-button" data-role="button" class="mapButton">Map</a>
				<a href="index.html" id="crop-button" data-role="button">Crops</a>
			</div>
		</div>
		
		<style type="text/css">
		      html { height: 100% }
		      body { height: 100%; margin: 0; padding: 0; overflow: hidden;}
		      #map {width: 100%; height: 100%;}
		      
		      #map-footer {
		      	position: fixed;
		      	width: 100%;
		      	bottom: 0px;
		      	background-color: #000;
		      	height: 40px;
		      }
		</style>
		    
		<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=AIzaSyDbm_tgr-6BMbH6BxoG2Sl2U_YAGIESjII&sensor=true">
		</script>
		
		<script type="text/javascript">
			var center;
			var map = null;
			var loc = null;
			var geocoder = null;
			var marker = null;
			
			$(document).ready(function() {
				geocoder = new google.maps.Geocoder();
				
				$(document).bind("pagechange", onPageChange);
			
				$("input[name='locationEntered']").click(function() {
					loc = $("input[name='location']").val();
					changeToMap();
					return false;
				});
				
				$("input[name='defaultLocation']").click(function() {
					changeToMap();
					return false;
				});
				
				$(".map").click(function() {
					$.mobile.changePage($("#page-map"));
					return false;
				});
				
				$(".homeButton").click(function() {
					changeToHome();
					return false;
				});
				
				$(".cropButton").click(function() {
					changeToCrop();
					return false;
				});
			});
			
			function initMap(lat,lng) {
				center = new google.maps.LatLng(lat,lng);
				var myOptions = {
					zoom: 14,
					center: center,
					mapTypeId: google.maps.MapTypeId.ROADMAP
				}
				
				map = new google.maps.Map(document.getElementById("map"), myOptions);
				
				google.maps.event.addListener(map, 'click', function(e) {
				    $("#map-header").slideDown();
				    $("#map-footer").fadeIn();
				    
				    if(marker == null) {
				    	 marker = new google.maps.Marker({
							position: e.latLng,
							map: map
						});
		  			}
		  			else {
		  				marker.setPosition(e.latLng);
		  			}
				    
				    window.setTimeout(function() {
						$("#map-header").slideUp();
						$("#map-footer").fadeOut();
					}, 5000);
				});
			}
			
			function detectBrowser() {
				var useragent = navigator.userAgent;
				var mapdivMap = document.getElementById("map");
				
				if (useragent.indexOf('iPhone') != -1 || useragent.indexOf('Android') != -1 ) {
					mapdivMap.style.width = '600';
					mapdivMap.style.height = '800';
				} 
				else {
					mapdivMap.style.width = '100%';
					mapdivMap.style.height = $(document).height() + 'px';
				}
			};
			
			function changeToHome() {
				$.mobile.changePage($("#page-start"));
			}
			
			function changeToMap() {
				$.mobile.changePage($("#page-map"));
			}
			
			function changeToCrop() {
				$.mobile.changePage($("#page-crop"));
			}
			
			function onPageChange(toPage, options) {		
				var page = options.toPage.attr("id");
				
				if(page == "page-map") {
					if(loc != null) {
						detectBrowser();
						geocoder.geocode( { 'address': loc}, function(results, status) {
			      			if (status == google.maps.GeocoderStatus.OK) {
			        			initMap(results[0].geometry.location.lat(),results[0].geometry.location.lng());
			      			} else {
			        			alert("Geocode was not successful for the following reason: " + status);
			      			}
			    		});
					}
					else {
						detectBrowser();
						initMap(51.4756, -3.1781);
					}
				}
			}
		</script>
	</body>
</html>